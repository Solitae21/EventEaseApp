@page "/events"
@using EventEaseApp.Services
@inject UserSession UserSession

<h3 class="mb-3">Event List</h3>

<div class="container">
    @foreach (var eventItem in events)
    {
        <div class="card mb-3" @key="eventItem.EventName">
            <EventCard EventName="@eventItem.EventName" EventDate="@eventItem.EventDate" Location="@eventItem.Location" />

            @{
                bool isRegistered = UserSession.RegisteredEvents.Contains(eventItem.EventName);
            }

            @if (isRegistered)
            {
                <div class="mt-2 text-success fw-bold">You're registered!</div>
            }
            else
            {
                <button class="btn btn-primary mt-2" @onclick="() => RegisterEvent(eventItem.EventName)">Register</button>
            }
        </div>
    }
</div>

@code {
    public class EventModel
    {
        public string EventName { get; set; } = string.Empty;
        public DateTime EventDate { get; set; }
        public string Location { get; set; } = string.Empty;
    }

    private List<EventModel> events = new();

    protected override void OnInitialized()
    {
        events = Enumerable.Range(1, 1000).Select(i => new EventModel
        {
            EventName = $"Event {i}",
            EventDate = DateTime.Now.AddDays(i),
            Location = $"Location {i}"
        }).ToList();
    }

    private void RegisterEvent(string eventName)
    {
        if (!UserSession.RegisteredEvents.Contains(eventName))
        {
            UserSession.RegisteredEvents.Add(eventName);
            StateHasChanged(); // Update UI after registration
        }
    }
}
